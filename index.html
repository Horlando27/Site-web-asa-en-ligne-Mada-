<!DOCTYPE html>
<html lang="mg">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bouton Service Client</title>
  <style>
    /* Reset */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background color: black;
    }

    /* Bouton Style */
    .service-client-button {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: linear-gradient(135deg, #007bff, #0056b3);
      color: white;
      padding: 12px 20px;
      border-radius: 50px;
      display: flex;
      align-items: center;
      text-decoration: none;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
      z-index: 9999;
    }

    .service-client-button:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.4);
      background: linear-gradient(135deg, #0056b3, #003f88);
    }

    .service-client-button img {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      margin-right: 12px;
      border: 2px solid white;
    }

    .service-client-button span {
      font-size: 16px;
      font-weight: 600;
    }

    /* Responsive Mobile */
    @media (max-width: 600px) {
      .service-client-button {
        padding: 10px 16px;
        right: 15px;
        bottom: 15px;
      }

      .service-client-button img {
        width: 24px;
        height: 24px;
        margin-right: 10px;
      }

      .service-client-button span {
        font-size: 14px;
      }
    }
  </style>
</head>
<body>

  <!-- Atiny hafa eto ambony raha ilaina -->
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>ASA EN LIGNE ETO MADA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* Style ankapobeny */
    body {
      font-family: Arial, sans-serif;
      background: #f2f2f2;
      margin: 0;
      padding: 20px;
      background color: black ;
    }
    .container {
      max-width: 400px;
      margin: 20px auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    h2 { text-align: center; }
    input[type="text"],
    input[type="email"],
    input[type="password"],
    input[type="number"] {
      width: 100%;
      padding: 10px;
      margin: 5px 0 15px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    button {
      width: 100%;
      padding: 10px;
      background: #28a745;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 5px;
    }
    button:hover { background: #218838; }
    .link {
      text-align: center;
      margin-top: 10px;
    }
    a { color: #007bff; text-decoration: none; }
    a:hover { text-decoration: underline; }
    .hidden { display: none; }
    
    /* Notification admin */
    #admin-notification {
      background: #fffae6;
      border: 1px solid #ffcc00;
      padding: 10px;
      border-radius: 4px;
      margin-bottom: 10px;
    }
    #admin-notification p {
      margin: 0 0 10px 0;
      font-size: 14px;
    }
    #admin-notification button {
      width: auto;
      padding: 5px 10px;
      font-size: 13px;
      margin-right: 5px;
    }
    
    /* Styles ho an'ny page d'accueil */
    #homepage {
      max-width: 1200px;
      margin: 20px auto;
      padding: 20px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    /* Navigation horizontal eo ambony ny page d'accueil */
    .home-nav {
      display: flex;
      justify-content: space-around;
      margin-bottom: 20px;
    }
    .home-nav button {
      flex: 1;
      margin: 0 5px;
      padding: 10px;
      background: #007bff;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .home-nav button:hover {
      background: #0056b3;
    }
    .home-section {
      display: none;
    }
    .home-section.active {
      display: block;
    }
  </style>
</head>
<body>
  <!-- Section d'inscription -->
  <div id="registration-section" class="container">
    <h2>Inscription</h2>
    <form onsubmit="event.preventDefault(); registerUser();">
      <input type="text" id="full-name" placeholder="Nom complet" required>
      <input type="email" id="reg-email" placeholder="E-mail" required>
      <input type="password" id="reg-password" placeholder="Mot de passe" required>
      <input type="password" id="reg-confirm-password" placeholder="Confirmer mot de passe" required>
      <button type="submit">S'inscrire</button>
    </form>
    <div class="link">
      D√©j√† un compte ? <a href="#" onclick="showLoginSection()">Connectez-vous</a>
    </div>
  </div>

  <!-- Section de connexion initiale -->
  <div id="login-section" class="container hidden">
    <h2>Connexion</h2>
    <form onsubmit="event.preventDefault(); loginUser();">
      <input type="email" id="login-email" placeholder="E-mail" required>
      <input type="password" id="login-password" placeholder="Mot de passe" required>
      <button type="submit">Se connecter</button>
    </form>
    <div class="link">
      <a href="#" onclick="resetPassword()">Mot de passe oubli√© ?</a>
    </div>
    <div class="link">
      Pas de compte ? <a href="#" onclick="showRegistrationSection()">S'inscrire</a>
    </div>
  </div>

  <!-- Section fampahafantarana fandoavana -->
  <div id="payment-instructions" class="container hidden">
    <h2>Effectuez votre paiement</h2>
    <p>Pour recevoir votre code d'activation, veuillez envoyer <strong>1000 Ar</strong> isambolana amin'ireo laharana manaraka:</p>
    <ul>
      <li>0323911654 [RAVELOMANANTSOA Urmin]</li>
      <li>0384557584 [BEFOTSY Ranjity]</li>
      <li>0333635111 [RANAIVOSON Angelo]</li>
    </ul>
    <button onclick="showPaymentProofForm()">J'ai pay√©</button>
  </div>

  <!-- Formulaire de preuve de paiement -->
  <div id="payment-proof" class="container hidden">
    <h2>Preuve de paiement</h2>
    <input type="text" id="proof-fullname" placeholder="Nom complet" required>
    <input type="text" id="proof-phone" placeholder="Num√©ro de t√©l√©phone utilis√©" required>
    <input type="number" id="proof-amount" placeholder="Montant √† payer" required>
    <button onclick="submitPaymentProof()">Envoyer</button>
  </div>

  <!-- Notification de paiement en attente -->
  <div id="pending-verification" class="container hidden">
    <h2>En attente de v√©rification</h2>
    <p>Votre demande de paiement est en attente de v√©rification par l'administration.</p>
  </div>

  <!-- Notification d'activation -->
  <div id="activation-notification" class="container hidden">
    <h2>Paiement confirm√©</h2>
    <div id="admin-notification" class="hidden">
      <p id="admin-notification-text">Vous avez un message de l'admin.</p>
      <button onclick="viewAdminMessage()">Voir</button>
      <button onclick="dismissAdminMessage()">Fermer</button>
    </div>
    <p id="activation-code-container">Voici votre nouveau code d'activation : <strong id="user-activation-code"></strong></p>
    <button onclick="showFinalActivationForm()">Connectez-vous</button>
  </div>

  <!-- Formulaire final d'activation -->
  <div id="final-activation-form" class="container hidden">
    <h2>Connexion - Activation</h2>
    <form onsubmit="event.preventDefault(); finalLogin();">
      <input type="email" id="final-email" placeholder="E-mail" required>
      <input type="password" id="final-password" placeholder="Mot de passe" required>
      <input type="text" id="final-activation-code" placeholder="Code d'activation" required>
      <button type="submit">Entrer</button>
    </form>
  </div>

  <!-- Page d'accueil (miseho rehefa activation vita) -->
  <div id="homepage" class="container hidden">
    <!-- Navigation horizontal ho an'ny section -->
    <div class="home-nav">
      <button onclick="showSection('asaMampiasaVola')">üèòÔ∏è</button>
      <button onclick="showSection('asaGratuit')">üíº</button>
      <button onclick="showSection('formationTrading')">üî≥</button>
      <button onclick="showSection('transaction')">üíµ</button>
    </div>
    <!-- Contenu isaky ny section -->
    <div id="homepage-content">
      <div id="asaMampiasaVola" class="home-section active">
          
      
      
      
      
      <!-- <!DOCTYPE html><html lang="mg">
<head>
  <meta charset="UTF-8">
  <title>Asa en Ligne ‚Äì Profil, Publication, Reactions & Private Chat</title>
  
  <style >/* --- Design Modern & Professionnel --- */
body {
  max-width: 700px;
  margin: 2em auto;
  font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  background: #f4f7fa;
  color: #333;
  padding: 0 1em;
  background color: black ;
}

h1, h2 {
  text-align: center;
  color: #2c3e50;
}

button {
  background-color: #007BFF;
  border: none;
  color: white;
  padding: 0.5em 1em;
  border-radius: 6px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

button:hover {
  background-color: #0056b3;
}

textarea,
input[type="text"],
input[type="url"] {
  width: 100%;
  padding: 0.6em;
  border: 1px solid #ccc;
  border-radius: 5px;
  margin: 6px 0 12px 0;
  font-size: 1em;
  box-sizing: border-box;
}

#form-section {
  background-color: #fff;
  border-radius: 10px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  padding: 1em;
  margin-bottom: 2em;
}

.post {
  background-color: #fff;
  padding: 1em;
  margin-bottom: 1.5em;
  border-radius: 10px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
  transition: transform 0.2s;
}

.post:hover {
  transform: translateY(-3px);
}

.post p {
  margin: 0.5em 0;
}

a {
  color: #007BFF;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

.reactions {
  margin: 1em 0;
}

.emoji-btn {
  font-size: 1.4em;
  margin-right: 10px;
  cursor: pointer;
  transition: transform 0.2s;
}

.emoji-btn:hover {
  transform: scale(1.2);
}

.emoji-btn sub {
  vertical-align: super;
  font-size: 0.6em;
  color: #444;
  margin-left: 3px;
}

.pm-btn {
  background: #e8f0fe;
  color: #0366d6;
  padding: 6px 12px;
  border-radius: 20px;
  font-weight: bold;
  margin-top: 10px;
  display: inline-block;
  transition: background 0.3s;
}

.pm-btn:hover {
  background: #d0e3ff;
}

.chat-section {
  margin-top: 1em;
  padding: 0.8em;
  background: #fdfdfd;
  border: 1px solid #ccc;
  border-radius: 8px;
}

.messages {
  max-height: 180px;
  overflow-y: auto;
  margin-bottom: 0.8em;
  padding: 0.4em;
  background: #f9f9f9;
  border-radius: 6px;
}

.msg-self {
  text-align: right;
  background-color: #dff0ff;
  padding: 6px 10px;
  border-radius: 12px;
  margin: 4px 0;
  color: #003f7f;
}

.msg-other {
  text-align: left;
  background-color: #eaf7e9;
  padding: 6px 10px;
  border-radius: 12px;
  margin: 4px 0;
  color: #2d672d;
}

.comments {
  margin-top: 1em;
}

.comment {
  background: #f6f9fc;
  border-left: 4px solid #007BFF;
  margin: 8px 0;
  padding: 0.5em 0.8em;
  border-radius: 4px;
}

.comment strong {
  color: #222;
}

.comment small {
  color: #777;
  float: right;
}

textarea#comment-input {
  margin-top: 8px;
  border-radius: 6px;
  resize: vertical;
}</style>
  <!-- Icons CDN -->
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-app.js";
    import {
      getAuth,
      onAuthStateChanged,
      signInWithEmailAndPassword,
      signOut
    } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-auth.js";
    import {
      getFirestore,
      collection,
      doc,
      addDoc,
      updateDoc,
      serverTimestamp,
      query,
      orderBy,
      onSnapshot,
      getDocs,
      increment
    } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-firestore.js";// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyCK4HqGSjYRT2jFNhAvniSWIzhDvEb2qAQ",
  authDomain: "asa-en-ligne.firebaseapp.com",
  projectId: "asa-en-ligne",
  storageBucket: "asa-en-ligne.appspot.com",
  messagingSenderId: "58359363245",
  appId: "1:58359363245:web:ca5969776ce9cd86aef824",
  measurementId: "G-MRVHVWPV71"
};
const app  = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db   = getFirestore(app);

// Demo Login
signInWithEmailAndPassword(auth, "user@example.com", "password123").catch(err => console.error(err));

onAuthStateChanged(auth, user => {
  document.getElementById('form-section').style.display = user ? 'block' : 'none';
  document.getElementById('auth-status').textContent = user ? `Miarahaba, ${user.displayName || user.email}` : 'Tsy tafiditra';
});

// Generate consistent chatId between two users
function getChatId(uid1, uid2) {
  return [uid1, uid2].sort().join('_');
}

// Post publication
window.postData = async () => {
  const desc = document.getElementById('description').value.trim();
  const userLink = document.getElementById('fb-link').value.trim();
  const user = auth.currentUser;
  if (!user || !desc || !userLink) return alert("Fenoy rehetra azafady");
  await addDoc(collection(db,'publications'), {
    author: user.uid,
    authorName: user.displayName || user.email,
    description: desc,
    fbLink: userLink,
    reactions: {},
    createdAt: serverTimestamp()
  });
  document.getElementById('description').value = '';
  document.getElementById('fb-link').value = '';
};

// React to post (emoji)
window.reactPost = async (postId, emoji) => {
  const postRef = doc(db,'publications',postId);
  await updateDoc(postRef, { [`reactions.${emoji}`]: increment(1) });
};

// Comment on post
window.commentOnPost = async (postId) => {
  const text = document.getElementById(`comment-input-${postId}`).value.trim();
  const user = auth.currentUser;
  if (!user || !text) return;
  await addDoc(collection(db,'publications',postId,'comments'), {
    author: user.uid,
    authorName: user.displayName || user.email,
    text,
    createdAt: serverTimestamp()
  });
  document.getElementById(`comment-input-${postId}`).value = '';
};

// Send private message and subscribe to chat
window.openChat = (post) => {
  const user = auth.currentUser;
  if (!user) return alert('Tsy tafiditra.');
  const chatId = getChatId(user.uid, post.author);
  const chatSection = document.getElementById(`chat-${post.id}`);
  chatSection.style.display = chatSection.style.display === 'none' ? 'block' : 'none';
  if (!chatSection.dataset.subscribed) {
    const msgsOut = chatSection.querySelector('.messages');
    const msgsQuery = query(collection(db,'privateChats',chatId,'messages'), orderBy('createdAt','asc'));
    onSnapshot(msgsQuery, snap => {
      msgsOut.innerHTML = '';
      snap.forEach(d => {
        const m = d.data();
        const cls = m.from === user.uid ? 'msg-self' : 'msg-other';
        msgsOut.innerHTML += `<div class="${cls}"><strong>${m.from === user.uid ? 'You' : post.authorName}:</strong> ${m.text}</div>`;
      });
    });
    chatSection.dataset.subscribed = 'true';
  }
  // attach send handler
  chatSection.querySelector('button').onclick = async () => {
    const input = chatSection.querySelector('input');
    const txt = input.value.trim();
    if (!txt) return;
    await addDoc(collection(db,'privateChats',chatId,'messages'), {
      from: user.uid,
      text: txt,
      createdAt: serverTimestamp()
    });
    input.value = '';
  };
};

// Display posts with reactions, comments, and chat
const q = query(collection(db,'publications'), orderBy('createdAt','desc'));
onSnapshot(q, async snapshot => {
  const out = document.getElementById('posts'); out.innerHTML = '';
  for (const docSnap of snapshot.docs) {
    const data = docSnap.data(); const id = docSnap.id;
    const when = data.createdAt?.toDate().toLocaleString() || '';
    // reactions
    const emojis = ['üëç','‚ù§Ô∏è','üòÇ','üòÆ','üò¢'];
    let reactHtml = emojis.map(e=>{
      const count = data.reactions?.[e]||0;
      return `<span class="emoji-btn" onclick="reactPost('${id}','${e}')">${e}<sub>${count}</sub></span>`;
    }).join(' ');
    // comments
    const commentsSnap = await getDocs(query(collection(db,'publications',id,'comments'),orderBy('createdAt','asc')));
    let commentsHtml = '';
    commentsSnap.forEach(c=>{
      const cd=c.data(); const cwhen = cd.createdAt?.toDate().toLocaleString()||'';
      commentsHtml += `<div class="comment"><strong>${cd.authorName}</strong> <small>${cwhen}</small><p>${cd.text}</p></div>`;
    });
    out.innerHTML += `
      <div class="post">
        <p><strong>${data.authorName}</strong> <em>${when}</em></p>
        <p>${data.description}</p>
        <p><a href="${data.fbLink}" target="_blank">Facebook Link</a></p>
        <div class="reactions">${reactHtml}</div>
        <button class="pm-btn" onclick='openChat(${JSON.stringify({ id, author: data.author, authorName: data.authorName })})'>üí¨ Chat</button>
        <div id="chat-${id}" class="chat-section" style="display:none;">
          <div class="messages"></div>
          <input type="text" placeholder="Type a message..."><button>Send</button>
        </div>
        <div class="comments">
          ${commentsHtml}
          <textarea id="comment-input-${id}" placeholder="Soraty hevitra‚Ä¶"></textarea>
          <button onclick="commentOnPost('${id}')">‚Ü©Ô∏è</button>
        </div>
      </div>
    `;
  }
});

  </script>
  <style>
    body{max-width:600px;margin:2em auto;font-family:sans-serif;}
    .emoji-btn{subscript-vertical-align:super;cursor:pointer;margin-right:8px;font-size:1.2em;}
    .pm-btn{background:none;border:none;cursor:pointer;color:#007BFF;margin:8px 0;font-size:1em;}
    .comment{margin:5px 0 5px 10px;padding:5px;border-left:2px solid #ccc;}
    textarea, input[type=text]{width:100%;margin:4px 0;}
    .post{border:1px solid #ddd;padding:1em;margin-bottom:1.5em;}
    .chat-section{border:1px solid #ccc;padding:0.5em;margin:0.5em 0;}
    .messages{max-height:150px;overflow-y:auto;margin-bottom:0.5em;}
    .msg-self{text-align:right;color:blue;}
    .msg-other{text-align:left;color:green;}
  </style>
</head>
<body>
  <h1>Asa en Ligne</h1>
  <p id="auth-status">‚Ä¶ mampiasa authentication ‚Ä¶</p>
  <section id="form-section" style="display:none;">
    <h2>Soraty ny hevitrao</h2>
    <textarea id="description" rows="3" placeholder="Ahoana ny hevitrao?‚Ä¶"></textarea><br>
    <input type="url" id="fb-link" placeholder="Lien Facebook‚Ä¶"><br>
    <button onclick="postData()">Alefa</button>
  </section>
  <hr>
  <div id="posts"></div>
</body>
</html> -->    
          
          
          
          
          
          
          
        <h2>FILAZANA </h2>
     <p style="background-color: #ffffff; padding: 25px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); border-left: 6px solid #007BFF; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 18px; line-height: 1.6; color: #333333; max-width: 700px; margin: 40px auto; text-align: justify;">
  ‚ö†Ô∏è Miala tsiny indrindra aminareo mpanjifa sy mpitsidika rehetra fa efa elaela izay no tsy niasa ny site Asa En Ligne Mada. 
  Nisy olana teknika tsy maintsy nojerentsika, ary tsy maintsy nandraisana fotoana kely ny fanarenana azy. 
  Efa miezaka mafy izahay amin‚Äôizao fotoana izao hanarenana sy hanavaozana tanteraka ilay site mba hahafahanareo manohy 
  mampiasa azy amin'ny fomba mahomby sy mahafinaritra. Mankasitraka ny faharetanareo sy ny fanohananareo hatrany!
     </p>
      </div>
      
      <div id="asaGratuit" class="home-section">
        <h2>Asa Gratuit</h2>
       
      </div>
      <div id="formationTrading" class="home-section">
        <h2>Formation Trading</h2>
        
      </div>
      <div id="transaction" class="home-section">
        <h2>Transaction</h2>
       <a href="https://demande-du-retrait.vercel.app/" target="_blank">
  <button style="padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">
    RETRAIT D'ARGENT 
  </button>

          </a>
      </div>
    </div>
  </div>

  <!-- Firebase + App JS -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-app.js";
    import {
      getAuth,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      sendPasswordResetEmail
    } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-auth.js";
    import {
      getFirestore,
      doc,
      setDoc,
      getDoc,
      updateDoc,
      addDoc,
      collection
    } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-firestore.js";

    // Configuration Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCK4HqGSjYRT2jFNhAvniSWIzhDvEb2qAQ",
      authDomain: "asa-en-ligne.firebaseapp.com",
      projectId: "asa-en-ligne",
      storageBucket: "asa-en-ligne.appspot.com",
      messagingSenderId: "58359363245",
      appId: "1:58359363245:web:ca5969776ce9cd86aef824",
      measurementId: "G-MRVHVWPV71"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Global variable ho an'ny hafatra admin
    let storedAdminMessage = "";

    // ----- Inscription -----
    window.registerUser = function() {
      const fullName = document.getElementById("full-name").value.trim();
      const email = document.getElementById("reg-email").value.trim();
      const password = document.getElementById("reg-password").value;
      const confirmPassword = document.getElementById("reg-confirm-password").value;
      if(password !== confirmPassword) {
        alert("Les mots de passe ne correspondent pas.");
        return;
      }
      createUserWithEmailAndPassword(auth, email, password)
        .then((userCredential) => {
          const user = userCredential.user;
          // Enregistrer l'utilisateur sans code d'activation tant que paiement non effectu√©
          setDoc(doc(db, "users", user.uid), {
            fullName: fullName,
            email: email,
            paymentStatus: "not_paid",
            createdAt: new Date()
          })
          .then(() => {
            alert("Inscription r√©ussie. Veuillez effectuer le paiement pour recevoir un code d'activation.");
            showLoginSection();
          })
          .catch((error) => alert("Erreur lors de l'enregistrement : " + error.message));
        })
        .catch((error) => alert("Erreur : " + error.message));
    };

    // ----- Affichage des sections -----
    window.showRegistrationSection = function() {
      document.getElementById("registration-section").classList.remove("hidden");
      document.getElementById("login-section").classList.add("hidden");
      document.getElementById("final-activation-form").classList.add("hidden");
      document.getElementById("activation-notification").classList.add("hidden");
      document.getElementById("payment-instructions").classList.add("hidden");
      document.getElementById("payment-proof").classList.add("hidden");
      document.getElementById("pending-verification").classList.add("hidden");
      document.getElementById("homepage").classList.add("hidden");
    };

    window.showLoginSection = function() {
      document.getElementById("registration-section").classList.add("hidden");
      document.getElementById("login-section").classList.remove("hidden");
      document.getElementById("final-activation-form").classList.add("hidden");
      document.getElementById("activation-notification").classList.add("hidden");
      document.getElementById("payment-instructions").classList.add("hidden");
      document.getElementById("payment-proof").classList.add("hidden");
      document.getElementById("pending-verification").classList.add("hidden");
      document.getElementById("homepage").classList.add("hidden");
    };

    // ----- Connexion initiale -----
    window.loginUser = function() {
      const email = document.getElementById("login-email").value.trim();
      const password = document.getElementById("login-password").value;
      signInWithEmailAndPassword(auth, email, password)
        .then(async (userCredential) => {
          const user = userCredential.user;
          const userDoc = await getDoc(doc(db, "users", user.uid));
          if(userDoc.exists()){
            const userData = userDoc.data();
            if(userData.paymentStatus === "confirmed") {
              // Afficher activation-notification avec code d'activation et notification admin √©ventuelle
              document.getElementById("activation-notification").classList.remove("hidden");
              document.getElementById("activation-code-container").innerHTML = 
                "Voici votre nouveau code d'activation : <strong id='user-activation-code'>" + userData.activationCode + "</strong>";
              if(userData.adminMessage) {
                storedAdminMessage = userData.adminMessage;
                document.getElementById("admin-notification-text").innerText = "Vous avez un message de l'admin.";
                document.getElementById("admin-notification").classList.remove("hidden");
              } else {
                document.getElementById("admin-notification").classList.add("hidden");
              }
            } else if(userData.paymentStatus === "pending") {
              document.getElementById("pending-verification").classList.remove("hidden");
            } else {
              document.getElementById("payment-instructions").classList.remove("hidden");
            }
          } else {
            alert("Aucune donn√©e utilisateur trouv√©e.");
          }
        })
        .catch(error => alert("Erreur : " + error.message));
    };

    window.resetPassword = function() {
      const email = document.getElementById("login-email").value.trim();
      if(!email) {
        alert("Veuillez entrer votre adresse e-mail.");
        return;
      }
      sendPasswordResetEmail(auth, email)
        .then(() => alert("Email de r√©initialisation envoy√© !"))
        .catch((error) => alert("Erreur : " + error.message));
    };

    // ----- Preuve de paiement -----
    window.showPaymentProofForm = function() {
      document.getElementById("payment-instructions").classList.add("hidden");
      document.getElementById("payment-proof").classList.remove("hidden");
    };

    window.submitPaymentProof = async function() {
      const proofFullName = document.getElementById("proof-fullname").value.trim();
      const proofPhone = document.getElementById("proof-phone").value.trim();
      const proofAmount = document.getElementById("proof-amount").value.trim();
      if(!proofFullName || !proofPhone || !proofAmount) {
        alert("Veuillez remplir tous les champs.");
        return;
      }
      try {
        await addDoc(collection(db, "paymentRequests"), {
          userId: auth.currentUser.uid,
          fullName: proofFullName,
          phone: proofPhone,
          amount: proofAmount,
          timestamp: new Date().toISOString(),
          status: "pending"
        });
        await updateDoc(doc(db, "users", auth.currentUser.uid), {
          paymentStatus: "pending"
        });
        alert("Votre demande de paiement a √©t√© envoy√©e et est en attente de v√©rification.");
        document.getElementById("payment-proof").classList.add("hidden");
        document.getElementById("pending-verification").classList.remove("hidden");
      } catch (error) {
        alert("Erreur lors de l'envoi de la preuve : " + error.message);
      }
    };

    // ----- Notification admin -----
    window.viewAdminMessage = function() {
      alert("Message de l'admin : " + storedAdminMessage);
      sessionStorage.setItem("adminMessageSeen", "true");
      document.getElementById("admin-notification").classList.add("hidden");
    };

    window.dismissAdminMessage = function() {
      sessionStorage.setItem("adminMessageSeen", "true");
      document.getElementById("admin-notification").classList.add("hidden");
    };

    // ----- Activation finale -----
    window.showFinalActivationForm = function() {
      document.getElementById("activation-notification").classList.add("hidden");
      document.getElementById("final-activation-form").classList.remove("hidden");
      const email = document.getElementById("login-email").value.trim();
      document.getElementById("final-email").value = email;
    };

    window.finalLogin = function() {
      const email = document.getElementById("final-email").value.trim();
      const password = document.getElementById("final-password").value;
      const activationCodeInput = document.getElementById("final-activation-code").value.trim();
      signInWithEmailAndPassword(auth, email, password)
        .then(async (userCredential) => {
          const user = userCredential.user;
          const userDoc = await getDoc(doc(db, "users", user.uid));
          if(userDoc.exists()){
            const userData = userDoc.data();
            if(userData.activationCode === activationCodeInput) {
              alert("Connexion r√©ussie !");
              // Afeno ny formulaire rehetra ary asehoy ny page d'accueil
              document.getElementById("registration-section").classList.add("hidden");
              document.getElementById("login-section").classList.add("hidden");
              document.getElementById("payment-instructions").classList.add("hidden");
              document.getElementById("payment-proof").classList.add("hidden");
              document.getElementById("pending-verification").classList.add("hidden");
              document.getElementById("activation-notification").classList.add("hidden");
              document.getElementById("final-activation-form").classList.add("hidden");
              // Asehoy ny page d'accueil
              document.getElementById("homepage").classList.remove("hidden");
            } else {
              alert("Code d'activation incorrect.");
            }
          } else {
            alert("Aucune donn√©e utilisateur trouv√©e.");
          }
        })
        .catch(error => alert("Erreur : " + error.message));
    };

    // ----- Navigation ao amin'ny page d'accueil -----
    window.showSection = function(sectionId) {
      const sections = document.querySelectorAll(".home-section");
      sections.forEach(section => {
        if(section.id === sectionId) {
          section.classList.add("active");
        } else {
          section.classList.remove("active");
        }
      });
    };
  </script>
</body>
  </html>
  
  <!-- Bouton Service Client -->
  <a href="https://service-client-asa-en-ligne-site-we.vercel.app/"
     class="service-client-button"
     target="_blank"
     title="Mifandraisa amin'ny Service Client">
    <img src="https://cdn-icons-png.flaticon.com/512/219/219983.png" alt="Client Icon">
    <span>Service Client</span>
  </a>

</body>
</html>
