<!DOCTYPE html>
<html lang="mg">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bouton Service Client</title>
  <style>
    /* Reset */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    /* Bouton Style */
    .service-client-button {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: linear-gradient(135deg, #007bff, #0056b3);
      color: white;
      padding: 12px 20px;
      border-radius: 50px;
      display: flex;
      align-items: center;
      text-decoration: none;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
      z-index: 9999;
    }

    .service-client-button:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.4);
      background: linear-gradient(135deg, #0056b3, #003f88);
    }

    .service-client-button img {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      margin-right: 12px;
      border: 2px solid white;
    }

    .service-client-button span {
      font-size: 16px;
      font-weight: 600;
    }

    /* Responsive Mobile */
    @media (max-width: 600px) {
      .service-client-button {
        padding: 10px 16px;
        right: 15px;
        bottom: 15px;
      }

      .service-client-button img {
        width: 24px;
        height: 24px;
        margin-right: 10px;
      }

      .service-client-button span {
        font-size: 14px;
      }
    }
  </style>
</head>
<body>

  <!-- Atiny hafa eto ambony raha ilaina -->
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>ASA EN LIGNE ETO MADA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* Style ankapobeny */
    body {
      font-family: Arial, sans-serif;
      background: #f2f2f2;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 400px;
      margin: 20px auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    h2 { text-align: center; }
    input[type="text"],
    input[type="email"],
    input[type="password"],
    input[type="number"] {
      width: 100%;
      padding: 10px;
      margin: 5px 0 15px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    button {
      width: 100%;
      padding: 10px;
      background: #28a745;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 5px;
    }
    button:hover { background: #218838; }
    .link {
      text-align: center;
      margin-top: 10px;
    }
    a { color: #007bff; text-decoration: none; }
    a:hover { text-decoration: underline; }
    .hidden { display: none; }
    
    /* Notification admin */
    #admin-notification {
      background: #fffae6;
      border: 1px solid #ffcc00;
      padding: 10px;
      border-radius: 4px;
      margin-bottom: 10px;
    }
    #admin-notification p {
      margin: 0 0 10px 0;
      font-size: 14px;
    }
    #admin-notification button {
      width: auto;
      padding: 5px 10px;
      font-size: 13px;
      margin-right: 5px;
    }
    
    /* Styles ho an'ny page d'accueil */
    #homepage {
      max-width: 1200px;
      margin: 20px auto;
      padding: 20px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    /* Navigation horizontal eo ambony ny page d'accueil */
    .home-nav {
      display: flex;
      justify-content: space-around;
      margin-bottom: 20px;
    }
    .home-nav button {
      flex: 1;
      margin: 0 5px;
      padding: 10px;
      background: #007bff;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .home-nav button:hover {
      background: #0056b3;
    }
    .home-section {
      display: none;
    }
    .home-section.active {
      display: block;
    }
  </style>
</head>
<body>
  <!-- Section d'inscription -->
  <div id="registration-section" class="container">
    <h2>Inscription</h2>
    <form onsubmit="event.preventDefault(); registerUser();">
      <input type="text" id="full-name" placeholder="Nom complet" required>
      <input type="email" id="reg-email" placeholder="E-mail" required>
      <input type="password" id="reg-password" placeholder="Mot de passe" required>
      <input type="password" id="reg-confirm-password" placeholder="Confirmer mot de passe" required>
      <button type="submit">S'inscrire</button>
    </form>
    <div class="link">
      D√©j√† un compte ? <a href="#" onclick="showLoginSection()">Connectez-vous</a>
    </div>
  </div>

  <!-- Section de connexion initiale -->
  <div id="login-section" class="container hidden">
    <h2>Connexion</h2>
    <form onsubmit="event.preventDefault(); loginUser();">
      <input type="email" id="login-email" placeholder="E-mail" required>
      <input type="password" id="login-password" placeholder="Mot de passe" required>
      <button type="submit">Se connecter</button>
    </form>
    <div class="link">
      <a href="#" onclick="resetPassword()">Mot de passe oubli√© ?</a>
    </div>
    <div class="link">
      Pas de compte ? <a href="#" onclick="showRegistrationSection()">S'inscrire</a>
    </div>
  </div>

  <!-- Section fampahafantarana fandoavana -->
  <div id="payment-instructions" class="container hidden">
    <h2>Effectuez votre paiement</h2>
    <p>Pour recevoir votre code d'activation, veuillez envoyer <strong>1000 Ar</strong> isambolana amin'ireo laharana manaraka:</p>
    <ul>
      <li>0323911654 [RAVELOMANANTSOA Urmin]</li>
      <li>0384557584 [BEFOTSY Ranjity]</li>
      <li>0333635111 [RANAIVOSON Angelo]</li>
    </ul>
    <button onclick="showPaymentProofForm()">J'ai pay√©</button>
  </div>

  <!-- Formulaire de preuve de paiement -->
  <div id="payment-proof" class="container hidden">
    <h2>Preuve de paiement</h2>
    <input type="text" id="proof-fullname" placeholder="Nom complet" required>
    <input type="text" id="proof-phone" placeholder="Num√©ro de t√©l√©phone utilis√©" required>
    <input type="number" id="proof-amount" placeholder="Montant √† payer" required>
    <button onclick="submitPaymentProof()">Envoyer</button>
  </div>

  <!-- Notification de paiement en attente -->
  <div id="pending-verification" class="container hidden">
    <h2>En attente de v√©rification</h2>
    <p>Votre demande de paiement est en attente de v√©rification par l'administration.</p>
  </div>

  <!-- Notification d'activation -->
  <div id="activation-notification" class="container hidden">
    <h2>Paiement confirm√©</h2>
    <div id="admin-notification" class="hidden">
      <p id="admin-notification-text">Vous avez un message de l'admin.</p>
      <button onclick="viewAdminMessage()">Voir</button>
      <button onclick="dismissAdminMessage()">Fermer</button>
    </div>
    <p id="activation-code-container">Voici votre nouveau code d'activation : <strong id="user-activation-code"></strong></p>
    <button onclick="showFinalActivationForm()">Connectez-vous</button>
  </div>

  <!-- Formulaire final d'activation -->
  <div id="final-activation-form" class="container hidden">
    <h2>Connexion - Activation</h2>
    <form onsubmit="event.preventDefault(); finalLogin();">
      <input type="email" id="final-email" placeholder="E-mail" required>
      <input type="password" id="final-password" placeholder="Mot de passe" required>
      <input type="text" id="final-activation-code" placeholder="Code d'activation" required>
      <button type="submit">Entrer</button>
    </form>
  </div>

  <!-- Page d'accueil (miseho rehefa activation vita) -->
  <div id="homepage" class="container hidden">
    <!-- Navigation horizontal ho an'ny section -->
    <div class="home-nav">
      <button onclick="showSection('asaMampiasaVola')">üèòÔ∏è</button>
      <button onclick="showSection('asaGratuit')">üíº</button>
      <button onclick="showSection('formationTrading')">üî≥</button>
      <button onclick="showSection('transaction')">üíµ</button>
    </div>
    <!-- Contenu isaky ny section -->
    <div id="homepage-content">
      <div id="asaMampiasaVola" class="home-section active">
        <h2>FILAZANA </h2>
     <p style="background-color: #ffffff; padding: 25px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); border-left: 6px solid #007BFF; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 18px; line-height: 1.6; color: #333333; max-width: 700px; margin: 40px auto; text-align: justify;">
  ‚ö†Ô∏è Miala tsiny indrindra aminareo mpanjifa sy mpitsidika rehetra fa efa elaela izay no tsy niasa ny site Asa En Ligne Mada. 
  Nisy olana teknika tsy maintsy nojerentsika, ary tsy maintsy nandraisana fotoana kely ny fanarenana azy. 
  Efa miezaka mafy izahay amin‚Äôizao fotoana izao hanarenana sy hanavaozana tanteraka ilay site mba hahafahanareo manohy 
  mampiasa azy amin'ny fomba mahomby sy mahafinaritra. Mankasitraka ny faharetanareo sy ny fanohananareo hatrany!
     </p>
      </div>
      
      <div id="asaGratuit" class="home-section">
        <h2>Asa Gratuit</h2>
       
      </div>
      <div id="formationTrading" class="home-section">
        <h2>Formation Trading</h2>
        
      </div>
      <div id="transaction" class="home-section">
        <h2>Transaction</h2>
       <a href="https://demande-du-retrait.vercel.app/" target="_blank">
  <button style="padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">
    RETRAIT D'ARGENT 
  </button>

         
       </a>
      </div>
    </div>
  </div>

  <!-- Firebase + App JS -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-app.js";
    import {
      getAuth,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      sendPasswordResetEmail
    } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-auth.js";
    import {
      getFirestore,
      doc,
      setDoc,
      getDoc,
      updateDoc,
      addDoc,
      collection
    } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-firestore.js";

    // Configuration Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCK4HqGSjYRT2jFNhAvniSWIzhDvEb2qAQ",
      authDomain: "asa-en-ligne.firebaseapp.com",
      projectId: "asa-en-ligne",
      storageBucket: "asa-en-ligne.appspot.com",
      messagingSenderId: "58359363245",
      appId: "1:58359363245:web:ca5969776ce9cd86aef824",
      measurementId: "G-MRVHVWPV71"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Global variable ho an'ny hafatra admin
    let storedAdminMessage = "";

    // ----- Inscription -----
    window.registerUser = function() {
      const fullName = document.getElementById("full-name").value.trim();
      const email = document.getElementById("reg-email").value.trim();
      const password = document.getElementById("reg-password").value;
      const confirmPassword = document.getElementById("reg-confirm-password").value;
      if(password !== confirmPassword) {
        alert("Les mots de passe ne correspondent pas.");
        return;
      }
      createUserWithEmailAndPassword(auth, email, password)
        .then((userCredential) => {
          const user = userCredential.user;
          // Enregistrer l'utilisateur sans code d'activation tant que paiement non effectu√©
          setDoc(doc(db, "users", user.uid), {
            fullName: fullName,
            email: email,
            paymentStatus: "not_paid",
            createdAt: new Date()
          })
          .then(() => {
            alert("Inscription r√©ussie. Veuillez effectuer le paiement pour recevoir un code d'activation.");
            showLoginSection();
          })
          .catch((error) => alert("Erreur lors de l'enregistrement : " + error.message));
        })
        .catch((error) => alert("Erreur : " + error.message));
    };

    // ----- Affichage des sections -----
    window.showRegistrationSection = function() {
      document.getElementById("registration-section").classList.remove("hidden");
      document.getElementById("login-section").classList.add("hidden");
      document.getElementById("final-activation-form").classList.add("hidden");
      document.getElementById("activation-notification").classList.add("hidden");
      document.getElementById("payment-instructions").classList.add("hidden");
      document.getElementById("payment-proof").classList.add("hidden");
      document.getElementById("pending-verification").classList.add("hidden");
      document.getElementById("homepage").classList.add("hidden");
    };

    window.showLoginSection = function() {
      document.getElementById("registration-section").classList.add("hidden");
      document.getElementById("login-section").classList.remove("hidden");
      document.getElementById("final-activation-form").classList.add("hidden");
      document.getElementById("activation-notification").classList.add("hidden");
      document.getElementById("payment-instructions").classList.add("hidden");
      document.getElementById("payment-proof").classList.add("hidden");
      document.getElementById("pending-verification").classList.add("hidden");
      document.getElementById("homepage").classList.add("hidden");
    };

    // ----- Connexion initiale -----
    window.loginUser = function() {
      const email = document.getElementById("login-email").value.trim();
      const password = document.getElementById("login-password").value;
      signInWithEmailAndPassword(auth, email, password)
        .then(async (userCredential) => {
          const user = userCredential.user;
          const userDoc = await getDoc(doc(db, "users", user.uid));
          if(userDoc.exists()){
            const userData = userDoc.data();
            if(userData.paymentStatus === "confirmed") {
              // Afficher activation-notification avec code d'activation et notification admin √©ventuelle
              document.getElementById("activation-notification").classList.remove("hidden");
              document.getElementById("activation-code-container").innerHTML = 
                "Voici votre nouveau code d'activation : <strong id='user-activation-code'>" + userData.activationCode + "</strong>";
              if(userData.adminMessage) {
                storedAdminMessage = userData.adminMessage;
                document.getElementById("admin-notification-text").innerText = "Vous avez un message de l'admin.";
                document.getElementById("admin-notification").classList.remove("hidden");
              } else {
                document.getElementById("admin-notification").classList.add("hidden");
              }
            } else if(userData.paymentStatus === "pending") {
              document.getElementById("pending-verification").classList.remove("hidden");
            } else {
              document.getElementById("payment-instructions").classList.remove("hidden");
            }
          } else {
            alert("Aucune donn√©e utilisateur trouv√©e.");
          }
        })
        .catch(error => alert("Erreur : " + error.message));
    };

    window.resetPassword = function() {
      const email = document.getElementById("login-email").value.trim();
      if(!email) {
        alert("Veuillez entrer votre adresse e-mail.");
        return;
      }
      sendPasswordResetEmail(auth, email)
        .then(() => alert("Email de r√©initialisation envoy√© !"))
        .catch((error) => alert("Erreur : " + error.message));
    };

    // ----- Preuve de paiement -----
    window.showPaymentProofForm = function() {
      document.getElementById("payment-instructions").classList.add("hidden");
      document.getElementById("payment-proof").classList.remove("hidden");
    };

    window.submitPaymentProof = async function() {
      const proofFullName = document.getElementById("proof-fullname").value.trim();
      const proofPhone = document.getElementById("proof-phone").value.trim();
      const proofAmount = document.getElementById("proof-amount").value.trim();
      if(!proofFullName || !proofPhone || !proofAmount) {
        alert("Veuillez remplir tous les champs.");
        return;
      }
      try {
        await addDoc(collection(db, "paymentRequests"), {
          userId: auth.currentUser.uid,
          fullName: proofFullName,
          phone: proofPhone,
          amount: proofAmount,
          timestamp: new Date().toISOString(),
          status: "pending"
        });
        await updateDoc(doc(db, "users", auth.currentUser.uid), {
          paymentStatus: "pending"
        });
        alert("Votre demande de paiement a √©t√© envoy√©e et est en attente de v√©rification.");
        document.getElementById("payment-proof").classList.add("hidden");
        document.getElementById("pending-verification").classList.remove("hidden");
      } catch (error) {
        alert("Erreur lors de l'envoi de la preuve : " + error.message);
      }
    };

    // ----- Notification admin -----
    window.viewAdminMessage = function() {
      alert("Message de l'admin : " + storedAdminMessage);
      sessionStorage.setItem("adminMessageSeen", "true");
      document.getElementById("admin-notification").classList.add("hidden");
    };

    window.dismissAdminMessage = function() {
      sessionStorage.setItem("adminMessageSeen", "true");
      document.getElementById("admin-notification").classList.add("hidden");
    };

    // ----- Activation finale -----
    window.showFinalActivationForm = function() {
      document.getElementById("activation-notification").classList.add("hidden");
      document.getElementById("final-activation-form").classList.remove("hidden");
      const email = document.getElementById("login-email").value.trim();
      document.getElementById("final-email").value = email;
    };

    window.finalLogin = function() {
      const email = document.getElementById("final-email").value.trim();
      const password = document.getElementById("final-password").value;
      const activationCodeInput = document.getElementById("final-activation-code").value.trim();
      signInWithEmailAndPassword(auth, email, password)
        .then(async (userCredential) => {
          const user = userCredential.user;
          const userDoc = await getDoc(doc(db, "users", user.uid));
          if(userDoc.exists()){
            const userData = userDoc.data();
            if(userData.activationCode === activationCodeInput) {
              alert("Connexion r√©ussie !");
              // Afeno ny formulaire rehetra ary asehoy ny page d'accueil
              document.getElementById("registration-section").classList.add("hidden");
              document.getElementById("login-section").classList.add("hidden");
              document.getElementById("payment-instructions").classList.add("hidden");
              document.getElementById("payment-proof").classList.add("hidden");
              document.getElementById("pending-verification").classList.add("hidden");
              document.getElementById("activation-notification").classList.add("hidden");
              document.getElementById("final-activation-form").classList.add("hidden");
              // Asehoy ny page d'accueil
              document.getElementById("homepage").classList.remove("hidden");
            } else {
              alert("Code d'activation incorrect.");
            }
          } else {
            alert("Aucune donn√©e utilisateur trouv√©e.");
          }
        })
        .catch(error => alert("Erreur : " + error.message));
    };

    // ----- Navigation ao amin'ny page d'accueil -----
    window.showSection = function(sectionId) {
      const sections = document.querySelectorAll(".home-section");
      sections.forEach(section => {
        if(section.id === sectionId) {
          section.classList.add("active");
        } else {
          section.classList.remove("active");
        }
      });
    };
  </script>
</body>
  </html>
  
  <!-- Bouton Service Client -->
  <a href="https://service-client-asa-en-ligne-site-we.vercel.app/"
     class="service-client-button"
     target="_blank"
     title="Mifandraisa amin'ny Service Client">
    <img src="https://cdn-icons-png.flaticon.com/512/219/219983.png" alt="Client Icon">
    <span>Service Client</span>
  </a>

</body>
</html>
